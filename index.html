<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Servis Telefona - Prijem uređaja (Firebase)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="module">
    // Firebase konfiguracija
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQzrYB_Nn1slM20I0KgfahM2wJ1c5bDq4",
      authDomain: "stanje-robe.firebaseapp.com",
      projectId: "stanje-robe",
      storageBucket: "stanje-robe.appspot.com",
      messagingSenderId: "685133583956",
      appId: "1:685133583956:web:c1b1c4b4cf5b765b86bfc1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const kolekcija = collection(db, "uredjaji");

    async function dodajUredjaj() {
      const klijent = document.getElementById('klijent').value.trim();
      const telefon = document.getElementById('telefon').value.trim();
      const marka = document.getElementById('marka').value.trim();
      const model = document.getElementById('model').value.trim();
      const kvar = document.getElementById('kvar').value.trim();
      const datum = document.getElementById('datum').value;

      if (!klijent || !telefon || !marka || !model || !kvar || !datum) {
        alert("Popuni sva polja!");
        return;
      }

      await addDoc(kolekcija, { klijent, telefon, marka, model, kvar, datum });
      ocistiFormu();
    }

    function ocistiFormu() {
      ['klijent','telefon','marka','model','kvar','datum'].forEach(id => {
        document.getElementById(id).value = "";
      });
    }

    onSnapshot(kolekcija, (snapshot) => {
      const tbody = document.getElementById("listaUredjaja");
      tbody.innerHTML = "";
      snapshot.forEach((doc) => {
        const u = doc.data();
        const red = `<tr>
          <td>${u.klijent}</td>
          <td>${u.telefon}</td>
          <td>${u.marka}</td>
          <td>${u.model}</td>
          <td>${u.kvar}</td>
          <td>${u.datum}</td>
        </tr>`;
        tbody.innerHTML += red;
      });
    });

    window.dodajUredjaj = dodajUredjaj;
  </script>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; }
    header {
      background: #1a73e8;
      color: white;
      padding: 15px;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
    }
    .container { padding: 20px; max-width: 900px; margin: auto; background: white; margin-top: 20px; border-radius: 8px; }
    input, button {
      padding: 10px;
      margin: 5px 0;
      font-size: 14px;
      width: 100%;
    }
    button {
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background: #e9eef6;
    }
  </style>
</head>
<body>
  <header>
    <span>📲 Prijem uređaja - Sinhronizacija</span>
    <button onclick="alert('Izlogovani ste')">Izloguj se</button>
  </header>
  <div class="container">
    <h2>📥 Novi uređaj</h2>
    <input id="klijent" placeholder="Ime klijenta">
    <input id="telefon" placeholder="Telefon">
    <input id="marka" placeholder="Marka uređaja">
    <input id="model" placeholder="Model uređaja">
    <input id="kvar" placeholder="Opis kvara">
    <input id="datum" type="date">
    <button onclick="dodajUredjaj()">Sačuvaj prijem</button>

    <h2>📋 Lista uređaja</h2>
    <table>
      <thead>
        <tr>
          <th>Klijent</th>
          <th>Telefon</th>
          <th>Marka</th>
          <th>Model</th>
          <th>Kvar</th>
          <th>Datum</th>
        </tr>
      </thead>
      <tbody id="listaUredjaja">
        <!-- Učitava se iz Firebase-a -->
      </tbody>
    </table>
  </div>
</body>
</html>
