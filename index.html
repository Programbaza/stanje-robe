<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Stanje robe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 10px; position: relative; }
    .top-right { position: absolute; top: 20px; right: 20px; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
    ul { list-style: none; padding: 0; }
    li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #ddd; }
    .hidden { display: none; }
    .btn-red { background-color: crimson; color: white; border: none; }
  </style>
</head>
<body>
  <div class="container" id="login">
    <h2>Prijava</h2>
    <input type="text" id="username" placeholder="Korisničko ime">
    <input type="password" id="password" placeholder="Lozinka">
    <button onclick="login()">Uđi</button>
    <p id="error-msg" style="color:red; display:none;">Pogrešni podaci</p>
  </div>

  <div class="container hidden" id="app">
    <button class="top-right" onclick="togglePasswordForm()">🔐 Promeni lozinku</button>
    <h2>Stanje robe</h2>
    <input type="text" id="search" placeholder="Pretraga..." oninput="filterList()">
    <ul id="lista"></ul>

    <input type="text" id="naziv" placeholder="Naziv">
    <input type="number" id="kolicina" placeholder="Količina">
    <button onclick="sacuvaj()">Sačuvaj</button>

    <div id="password-section" class="hidden">
      <h3>Promeni lozinku</h3>
      <input type="password" id="new-pass" placeholder="Nova lozinka">
      <button onclick="promeniLozinku()">Sačuvaj lozinku</button>
      <p id="pass-msg" style="color:green; display:none;">Lozinka sačuvana</p>
    </div>

    <button class="btn-red" onclick="logout()">Izloguj se</button>
  </div>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAQzrYB_Nn1slM20I0KgfahM2wJ1c5bDq4",
      authDomain: "stanje-robe.firebaseapp.com",
      databaseURL: "https://stanje-robe-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "stanje-robe"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let editKey = null;
    let pass = localStorage.getItem("pass") || "1234";

    function login() {
      const u = document.getElementById('username').value;
      const p = document.getElementById('password').value;
      if (u === 'admin' && p === pass) {
        localStorage.setItem("loggedIn", "true");
        showApp();
      } else {
        document.getElementById('error-msg').style.display = "block";
      }
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      location.reload();
    }

    function showApp() {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
    }

    if (localStorage.getItem("loggedIn") === "true") showApp();

    function sacuvaj() {
      const naziv = document.getElementById("naziv").value.trim();
      const kolicina = parseInt(document.getElementById("kolicina").value);
      if (!naziv || !kolicina) return;

      if (editKey) {
        db.ref("artikli/" + editKey).set({ naziv, kolicina });
        editKey = null;
      } else {
        db.ref("artikli").push({ naziv, kolicina });
      }
      document.getElementById("naziv").value = "";
      document.getElementById("kolicina").value = "";
    }

    function prikazi(snapshot) {
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      snapshot.forEach((child) => {
        const item = child.val();
        const key = child.key;
        const li = document.createElement("li");
        li.innerHTML = `<span>${item.naziv} (${item.kolicina})</span>
          <span>
            <button onclick="uredi('${key}', '${item.naziv}', ${item.kolicina})">✏️</button>
            <button onclick="obrisi('${key}')">🗑️</button>
          </span>`;
        li.dataset.naziv = item.naziv.toLowerCase();
        lista.appendChild(li);
      });
    }

    function uredi(key, naziv, kolicina) {
      document.getElementById("naziv").value = naziv;
      document.getElementById("kolicina").value = kolicina;
      editKey = key;
    }

    function obrisi(key) {
      db.ref("artikli/" + key).remove();
    }

    function filterList() {
      const query = document.getElementById("search").value.toLowerCase();
      document.querySelectorAll("#lista li").forEach(li => {
        li.style.display = li.dataset.naziv.includes(query) ? "" : "none";
      });
    }

    function togglePasswordForm() {
      const section = document.getElementById("password-section");
      section.classList.toggle("hidden");
    }

    function promeniLozinku() {
      const nova = document.getElementById("new-pass").value;
      if (nova.trim()) {
        pass = nova.trim();
        localStorage.setItem("pass", pass);
        document.getElementById("new-pass").value = "";
        document.getElementById("pass-msg").style.display = "block";
        setTimeout(() => document.getElementById("pass-msg").style.display = "none", 3000);
      }
    }

    db.ref("artikli").on("value", prikazi);
  </script>
</body>
</html>
